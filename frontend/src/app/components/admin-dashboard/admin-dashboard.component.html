<div class="admin-dashboard">
  <h2>Admin Dashboard</h2>
  
  <mat-tab-group>
    <!-- Books Management Tab -->
    <mat-tab label="Manage Books">
      <div class="tab-content">
        <div class="action-bar">
          <button mat-raised-button color="primary" (click)="openBookForm()">
            <mat-icon>add</mat-icon> Add New Book
          </button>
        </div>
        
        <div class="search-container">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search books</mat-label>
            <input matInput [(ngModel)]="searchQuery" (keyup.enter)="searchBooks()">
            <button mat-icon-button matSuffix (click)="searchBooks()">
              <mat-icon>search</mat-icon>
            </button>
          </mat-form-field>
        </div>
        
        <div *ngIf="loading" class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
        
        <div *ngIf="!loading && books.length === 0" class="no-data">
          <p>No books found. Add some books to the library.</p>
        </div>
        
        <div *ngIf="!loading && books.length > 0" class="books-table-container">
          <table mat-table [dataSource]="books" class="books-table">
            <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef>Title</th>
              <td mat-cell *matCellDef="let book">{{book.title}}</td>
            </ng-container>
            
            <ng-container matColumnDef="author">
              <th mat-header-cell *matHeaderCellDef>Author</th>
              <td mat-cell *matCellDef="let book">{{book.author}}</td>
            </ng-container>
            
            <ng-container matColumnDef="category">
              <th mat-header-cell *matHeaderCellDef>Category</th>
              <td mat-cell *matCellDef="let book">{{book.category}}</td>
            </ng-container>
            
            <ng-container matColumnDef="copies">
              <th mat-header-cell *matHeaderCellDef>Copies</th>
              <td mat-cell *matCellDef="let book">{{book.availableCopies}} / {{book.totalCopies}}</td>
            </ng-container>
            
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let book">
                <button mat-icon-button color="primary" (click)="editBook(book)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="deleteBook(book.id)">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>
            
            <tr mat-header-row *matHeaderRowDef="bookColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: bookColumns;"></tr>
          </table>
        </div>
      </div>
    </mat-tab>
    
    <!-- Borrow Requests Tab -->
    <mat-tab label="Borrow Requests">
      <div class="tab-content">
        <div class="filter-container">
          <mat-button-toggle-group [(ngModel)]="requestFilter" (change)="filterRequests()">
            <mat-button-toggle value="PENDING">Pending</mat-button-toggle>
            <mat-button-toggle value="APPROVED">Approved</mat-button-toggle>
            <mat-button-toggle value="REJECTED">Rejected</mat-button-toggle>
            <mat-button-toggle value="RETURNED">Returned</mat-button-toggle>
            <mat-button-toggle value="ALL">All</mat-button-toggle>
          </mat-button-toggle-group>
        </div>
        
        <div *ngIf="loadingRequests" class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
        
        <div *ngIf="!loadingRequests && borrowRequests.length === 0" class="no-data">
          <p>No borrow requests found.</p>
        </div>
        
        <div *ngIf="!loadingRequests && borrowRequests.length > 0" class="requests-table-container">
          <table mat-table [dataSource]="borrowRequests" class="requests-table">
            <ng-container matColumnDef="user">
              <th mat-header-cell *matHeaderCellDef>User</th>
              <td mat-cell *matCellDef="let request">{{request.user.name}}</td>
            </ng-container>
            
            <ng-container matColumnDef="book">
              <th mat-header-cell *matHeaderCellDef>Book</th>
              <td mat-cell *matCellDef="let request">{{request.book.title}}</td>
            </ng-container>
            
            <ng-container matColumnDef="borrowDate">
              <th mat-header-cell *matHeaderCellDef>Borrow Date</th>
              <td mat-cell *matCellDef="let request">{{request.borrowDate | date:'mediumDate'}}</td>
            </ng-container>
            
            <ng-container matColumnDef="returnDate">
              <th mat-header-cell *matHeaderCellDef>Return Date</th>
              <td mat-cell *matCellDef="let request">{{request.returnDate ? (request.returnDate | date:'mediumDate') : 'N/A'}}</td>
            </ng-container>
            
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let request">
                <span [ngClass]="'status-' + request.status.toLowerCase()">{{request.status}}</span>
              </td>
            </ng-container>
            
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let request">
                <div *ngIf="request.status === 'PENDING'">
                  <button mat-icon-button color="primary" (click)="approveBorrowRequest(request.id)">
                    <mat-icon>check_circle</mat-icon>
                  </button>
                  <button mat-icon-button color="warn" (click)="rejectBorrowRequest(request.id)">
                    <mat-icon>cancel</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>
            
            <tr mat-header-row *matHeaderRowDef="requestColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: requestColumns;"></tr>
          </table>
        </div>
      </div>
    </mat-tab>
    
    <!-- Users Tab -->
    <mat-tab label="Users">
      <div class="tab-content">
        <div *ngIf="loadingUsers" class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
        
        <div *ngIf="!loadingUsers && users.length === 0" class="no-data">
          <p>No users found.</p>
        </div>
        
        <div *ngIf="!loadingUsers && users.length > 0" class="users-table-container">
          <table mat-table [dataSource]="users" class="users-table">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let user">{{user.name}}</td>
            </ng-container>
            
            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef>Email</th>
              <td mat-cell *matCellDef="let user">{{user.email}}</td>
            </ng-container>
            
            <ng-container matColumnDef="role">
              <th mat-header-cell *matHeaderCellDef>Role</th>
              <td mat-cell *matCellDef="let user">{{user.role}}</td>
            </ng-container>
            
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let user">
                <button mat-button color="primary" (click)="viewUserBorrowHistory(user.id)">View History</button>
              </td>
            </ng-container>
            
            <tr mat-header-row *matHeaderRowDef="userColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: userColumns;"></tr>
          </table>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
